<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        #slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black; /* Prevent white flash */
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            will-change: opacity; /* Optimize for animations */
        }
        .slide.active {
            opacity: 1;
        }
        .slide img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 5s linear;
            will-change: transform; /* Optimize for animations */
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="astro.html">Astro Images</a></li>
                <li><a href="about.html">About Me</a></li>
                <li><a href="hikes.html">Hikes</a></li>
            </ul>
        </nav>
    </header>

    <div id="slideshow"></div>

    <script>
        const slideshow = document.getElementById('slideshow');
        const images = [
            'astro-images/andromeda.jpg',
            'astro-images/heart.jpg',
        ];
        let currentSlide = 0;
        const ANIMATION_DURATION = 5000; // 5 seconds
        const MAX_MOVE_PERCENT = 10;

        function preloadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        async function createSlide(imageSrc) {
            const slide = document.createElement('div');
            slide.classList.add('slide');
            const img = await preloadImage(imageSrc);
            slide.appendChild(img);
            return slide;
        }

        function calculateMinScale(img, containerWidth, containerHeight) {
            const imageAspect = img.naturalWidth / img.naturalHeight;
            const containerAspect = containerWidth / containerHeight;
            let scale;

            if (imageAspect > containerAspect) {
                scale = containerHeight / img.naturalHeight;
            } else {
                scale = containerWidth / img.naturalWidth;
            }

            return scale * (1 + MAX_MOVE_PERCENT / 100);
        }

        function applyEffect(slide) {
            const img = slide.querySelector('img');
            const containerWidth = slideshow.clientWidth;
            const containerHeight = slideshow.clientHeight;
            const minScale = calculateMinScale(img, containerWidth, containerHeight);
            
            const startScale = minScale * (1 + Math.random() * 0.1);
            const endScale = minScale * (1 + Math.random() * 0.1);
            
            const maxMoveX = (containerWidth * MAX_MOVE_PERCENT / 200) / minScale;
            const maxMoveY = (containerHeight * MAX_MOVE_PERCENT / 200) / minScale;
            
            const startX = Math.random() * maxMoveX * 2 - maxMoveX;
            const startY = Math.random() * maxMoveY * 2 - maxMoveY;
            const endX = Math.random() * maxMoveX * 2 - maxMoveX;
            const endY = Math.random() * maxMoveY * 2 - maxMoveY;

            img.style.transform = `translate(-50%, -50%) scale(${startScale}) translate(${startX}px, ${startY}px)`;

            // Force a reflow before starting the animation
            void img.offsetWidth;

            img.style.transition = `transform ${ANIMATION_DURATION}ms linear`;
            img.style.transform = `translate(-50%, -50%) scale(${endScale}) translate(${endX}px, ${endY}px)`;
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
            applyEffect(slides[index]);
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % images.length;
            showSlide(currentSlide);
        }

        async function initSlideshow() {
            const slides = await Promise.all(images.map(createSlide));
            slides.forEach(slide => slideshow.appendChild(slide));
            showSlide(0);
            setInterval(nextSlide, ANIMATION_DURATION);
        }

        initSlideshow();

        window.addEventListener('resize', () => {
            showSlide(currentSlide);
        });
    </script>
</body>
</html>